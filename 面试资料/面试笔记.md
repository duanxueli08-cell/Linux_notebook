###  上课提及面试点

之前公司服务器规模，简单说一下框架结构

#### 说说你之前的公司（工作）监控目标

以purometheus来说，有些是资源类的、有些是业务类的、有些是趋势类的；

资源类又可以细分为硬件设备、系统资源、应用软件

……后面的内容以后说，笔记先记到这里！

#### linux中定时任务的格式 

```powershell
# 分时日月周
* * * * * 
# 示例：每周一的五点整执行打包指令
0 5 * * 1 tar -zcf /var/backups/home.tgz /home/
```

#### 运维与微服务常用端口号总表
[[常用端口号总表]]

#### 查看当前主机的负载情况

```powershell
root@ubuntu-201:~# uptime
 12:55:53 up 10:25,  1 user,  load average: 0.00, 0.00, 0.02
# 当前时间；运行时长；当前登陆用户数量；系统在最后1分5分15分三个时间段的平均负载值
对于单个CPU核心的系统，如果平均负载为1.00，表示CPU刚好满负荷。如果超过1.00，表示有进程在排队等待。
```

> “平均负载”指的是处于可运行状态和不可中断状态的进程的平均数量。
>
> - 可运行状态：正在使用CPU或等待使用CPU的进程。
> - 不可中断状态：正在等待I/O（如磁盘读写）完成的进程

#### 查看系统进程中的僵尸态

```powershell
# top 命令可以动态实时地查看系统状态，包括僵尸进程的数量
示例输出：
top - 13:16:53 up 10:46,  1 user,  load average: 0.01, 0.02, 0.00
Tasks: 267 total,   1 running, 266 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni, 99.9 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st 
MiB Mem :   3868.0 total,   2959.2 free,    469.9 used,    667.5 buff/cache     
MiB Swap:   3868.0 total,   3868.0 free,      0.0 used.   3398.1 avail Mem 
扩展：上述信息分为四大部分说明，分别是：
# 系统概况：当前时间；运行时长；登陆用户数量；平均负载
# 进程统计：总进程数量；运行数；睡眠数；暂停数；僵尸进程数
# CPU使用情况：用户空间进程占用CPU百分比；内核空间；被调整优先级的进程；空闲；……
# 内存空间：总内存；空闲内存；已使用；缓存、缓冲
# 交换空间：略
```



#### 说一下http协议的工作原理

http协议就是客户端通过tcp连接向服务器发送一个格式化的请求，然后服务器处理并返回一个格式湖的响应，最后客户端根据这个响应内容进行处理并展示。

http协议是建立在tcp协议之上的，客户端首先要与服务器指定的端口建立可靠的tcp连接；

连接建立后，客户端回想服务器发送一个格式标准的“请求报文” ，这个报文有三个部分组成，分别是请求行、请求头、请求体；

请求行包含get、post、url地址以及http版本，请求头包含一些附加信息（比如客户端类型、接受的数据格式），请求体用于存放发送给服务器的数据（如表单数据）；

服务器收到请求后会根据get、post和url找到对应的资源并进行处理，然后生成一个“响应报文”给客户端，这个响应报文由状态行、响应头和响应体组成；

状态行包含http版本、状态码和状态说明，响应头包含响应的元信息（如服务器类型、内容类型、长度等），响应体就是返回给客户端的实际内容；

在默认http/1.0模式下，响应发送完毕，服务器就会关闭该tcp连接，而在http/1.1及以后的版本中，默认使用持久连接，如此可以在同一连接上发送多个请求和响应；

“所以，总结来说，HTTP 协议的核心就是基于 TCP 的‘请求-响应’模型。也正是因为这个工作原理，它衍生出两个非常重要的特点：

1. **无状态**：协议本身不记录之前的请求信息，每个请求都是独立的。这也是为什么我们需要 Cookie、Session 这样的技术来维持用户状态。
2. **明文传输**：HTTP 本身是明文的，存在安全风险。因此，在涉及安全的场景下，我们使用 HTTPS，它就是在 HTTP 和 TCP 之间增加了一个 SSL/TLS 加密层。”

说一下你对mysql的看法以及mysql主从复制的工作原理

MySQL 是大多数 Web 应用的首选，在成本、性能和易用性之间取得了绝佳的平衡。但当业务发展到超大规模，需要进行复杂的水平扩展或重型分析时，就需要考虑引入其他技术方案了。

主从复制的核心是基于二进制日志的异步复制。

当主库执行完增删改这类数据变更的操作后，会将这些更改事件按序记录到本地的二进制日志文件中；而二进制文件记录了所有数据库结构以及内容产生变动的记录；从库会新启动一个I/0线程用于请求主从上的二进制文件内容，并将其拷贝到从库本地的中继日志中；从库会启动一个sql线程读取本地的中继日志，解析中继日志中的事件，并在从库中重新执行这些sql指令，从而使从库数据与主库保持一致。

这种异步复制的模式。它的优点是性能好、对主库影响小；但缺点是它**存在延迟**，在某些极端情况下，可能会遇到从库数据落后于主库的问题。为了缩减缺点带来的影响会在性能允许的情况下尽量减少异步复制的周期间隔！

#### 简单说一下nginx配置文件中的worker_processes auto;

这是 Nginx 配置中一个非常实用的指令。它表示：**让 Nginx 自动设置工作进程的数量，通常等于你服务器 CPU 的核心数。**

它让 Nginx 自动根据你的服务器硬件来配置工作进程，以实现高效的并发处理。在绝大多数生产环境中，这都是推荐的首选配置。

#### 简单说一下容器之间的通讯访问过程

数据包从容器A的`eth0`发出，通过`veth pair`到达宿主机端的虚拟网卡，`docker0`网桥（像交换机）接收数据包，`docker0`根据目标IP/MAC地址，将数据包转发到容器B对应的veth端点，通过`veth pair`到达容器B的`eth0`，容器B的应用收到数据包

**总结**：容器数据通过虚拟网线，即启动容器时成对出现的网卡，之后连接到docker0模拟出来的二层交换机，再由交换机转发到目标容器。

#### 跨主机容器通信做过吗？

我们没有做过跨主机通信，docker无法解决这个问题，我们是通过第三方工具 （k8s fllannel,calico ）解决这个问题的！

- Docker 有哪些常用指令？
- Dockerfile 有哪些指令?
- 两个服务器装了 Docker，双方的容器之间如何实现通信,有几种方式，不同主机的两个容器之间能
- 够通信吗，怎么实现?
- Docker 的网络模式有几种？
- Docker的版本号是多少
- Docker容器中如何对外映射内部的端口？
- 如何找到某个 Docker容器的输出日志的宿主机位置？
- Docker的Dockerfile中的expose端口暴露与命令执行暴露的区别
- Docker 如何查看镜像
- Docker 如何实现容器间互联
- Docker使用到哪些技术？分别有什么作用？
- docker run 运行一个容器，端口映射为8080，一段时间之后忘记当初运行这个容器的命令，请问
- 如何修改映射的端口？
- Dockerfile常用指令有哪些？CMD和entrypoint有什么区别？ADD个COPY有什么区别？
- Docker是使用什么协议进行通信的？
- Dockerfile CMD,RUN 区别
- Dockerfile 做了哪些优化
- Docker 打镜像时需不需要对容器内操作系统进行内核参数优化？、


### Nacos 面试中高频问及知识点

Nacos 是阿里巴巴开源的动态服务发现、配置管理和服务管理平台，常用于微服务架构（如 Spring Cloud Alibaba）。在面试中，高频问题通常围绕其核心功能（服务注册/发现、配置管理）、架构设计、一致性模式、部署优化等展开。以下基于常见面试经验和官方文档，整理了 15 个高频知识点及简要解答（包含原理、场景和注意事项）。这些问题多见于中高级 Java/后端开发岗位，建议结合实际项目经验扩展回答。

#### 1. **Nacos 是什么？其主要功能有哪些？**
   - **解答**：Nacos 是动态服务发现、配置和服务管理平台，支持服务注册/发现、动态配置管理、流量治理等。核心功能包括：服务注册与发现（支持 DNS/HTTP 接口查询）、动态配置（运行时热更新）、服务健康检查（心跳机制）和命名空间隔离（多环境管理）。相比 Eureka，它支持 CP/AP 模式切换，更适合大规模微服务。
   - **场景**：微服务拆分后，用于统一管理服务实例和配置，避免硬编码。
   - **注意**：Nacos = Registry（注册中心） + Config（配置中心） + Bus（总线）。

#### 2. **Nacos 与 Eureka/Zookeeper 的区别？**
   - **解答**：Nacos 支持 AP（最终一致性，高可用）和 CP（强一致性）模式（临时实例默认 AP，非临时用 Raft 协议 CP）；Eureka 只支持 AP，Zookeeper 默认 CP。Nacos 配置管理更强（支持动态推送），Eureka 无配置中心；Nacos 性能更高，支持 gRPC 持久连接（2.x 版本）。
   - **场景**：生产环境需高可用选 AP 模式，数据一致性强选 CP。
   - **注意**：Nacos 集群默认 AP，当有非临时实例时切换 CP。

#### 3. **临时实例和永久实例的区别？如何配置？**
   - **解答**：临时实例（ephemeral=true，默认）存储在内存，依赖心跳保活（5s 发送，15s 不健康，30s 移除）；永久实例（ephemeral=false）存储在 MySQL，用 Raft 协议同步，适合静态服务。配置：在 bootstrap.yml 中设置 `spring.cloud.nacos.discovery.ephemeral: false`。
   - **场景**：容器化服务用临时实例，边缘服务用永久。
   - **注意**：临时实例支持 AP 模式，永久支持 CP。

#### 4. **Nacos 服务注册与发现的原理？**
   - **解答**：注册：客户端启动时通过 SDK 发送注册请求（包含服务名、IP、端口），Server 验证后存入内存/MySQL。发现：消费者通过服务名查询实例列表，支持负载均衡（Weight/Random）。心跳：5s 发送，Server 记录变化并推送（长轮询 30s）。
   - **场景**：服务启动后自动注册，消费者拉取实例调用。
   - **注意**：2.x 版本引入 gRPC 持久连接，减少延迟。

#### 5. **Nacos 如何实现服务健康检查？**
   - **解答**：临时实例用心跳（5s 一次），超时 15s 标记不健康、30s 移除；永久实例用主动检测（TCP/HTTP）。消费者本地缓存实例，支持客户端负载均衡。
   - **场景**：避免调用故障实例，确保流量倾斜健康节点。
   - **注意**：可自定义健康检查路径，如 `/actuator/health`。

#### 6. **Nacos 配置管理的动态更新如何实现？**
   - **解答**：客户端拉取配置（MD5 校验），通过长轮询监听变更（30s 超时）。Server 推送变更时，客户端热加载（Spring 用 `@RefreshScope`）。支持共享配置（extension-configs）。
   - **场景**：修改数据库 URL 无需重启服务。
   - **注意**：bootstrap.yml 优先加载 Nacos 配置，需设置 `spring.cloud.nacos.config.refresh-enabled: true`。

#### 7. **Nacos 支持哪些一致性模式？如何选择？**
   - **解答**：AP 模式（Distro 协议，最终一致性，高可用，默认临时实例）；CP 模式（Raft 协议，强一致性，非临时实例）。配置：`nacos.consistency.model: CP`。
   - **场景**：读多写少用 AP，关键数据用 CP。
   - **注意**：配置中心数据统一存 MySQL，无 CP/AP 区分。

#### 8. **Nacos 的负载均衡如何实现？与 Ribbon 的关系？**
   - **解答**：Nacos 提供服务端负载（随机/权重），客户端通过 Ribbon（轮询/随机）进一步均衡。Nacos 先过滤实例，Ribbon 选一个。
   - **场景**：多实例服务调用，避免热点。
   - **注意**：支持保护阈值（default 0.5），健康实例 < 阈值时返回所有实例防雪崩。

#### 9. **Nacos 集群部署和高可用如何保障？**
   - **解答**：至少 3 节点集群，用 Distro/Raft 同步数据。推荐 MySQL 持久化。客户端支持多 Server 地址 failover。
   - **场景**：单点故障时，其他节点接管。
   - **注意**：standalone 模式仅开发用，生产需集群 + VIP。

#### 10. **Nacos 的就近访问（集群间路由）如何实现？**
    - **解答**：通过 cluster-name 分组实例，消费者优先选同 cluster 的提供者（基于服务 A 的 cluster 匹配 B）。
    - **场景**：多地域部署，降低跨区延迟。
    - **注意**：需在注册时设置 cluster-name。

#### 11. **Nacos 的保护阈值是什么？作用？**
    - **解答**：阈值（0-1，默认 0.5），健康实例比例 < 阈值时，返回所有实例（含不健康）给消费者，防止剩余实例过载。
    - **场景**：服务雪崩时，临时降级流量。
    - **注意**：配置 `preserve-heartbeat-timeout-milliseconds` 调整。

#### 12. **Nacos 如何处理数据同步和增量更新？**
    - **解答**：临时实例用 Distro 协议全量/增量同步（变更后推送）；永久用 Raft 共识。增量：只同步变更（如注册/注销）。
    - **场景**：集群间保持一致，减少网络开销。
    - **注意**：2.x 优化了 gRPC 推送，QPS 更高。

#### 13. **Nacos 命名空间的作用？如何隔离环境？**
    - **解答**：命名空间（namespace）逻辑隔离多环境（如 dev/prod），每个有独立配置/服务列表。创建：在控制台新建，客户端指定 `spring.cloud.nacos.discovery.namespace`。
    - **场景**：避免 dev 配置影响 prod。
    - **注意**：默认 public 命名空间。

#### 14. **Nacos 性能优化和故障排查？**
    - **解答**：优化：增加节点、调连接池、启用缓存、调整心跳间隔。排查：日志（-Dnacos.logging.level=debug）、监控指标（Prometheus 集成）、常见问题如 Derby 锁（切换 MySQL）。
    - **场景**：高并发下 QPS 瓶颈。
    - **注意**：2.x 版本性能提升 2-3 倍。

#### 15. **Nacos 在 Spring Cloud 中的集成？常见配置？**
    - **解答**：添加 `spring-cloud-starter-alibaba-nacos-discovery/config` 依赖。在 bootstrap.yml 配置 server-addr、namespace。服务注册用 `@EnableDiscoveryClient`，配置用 `@Value` 或 `@NacosValue`。
    - **场景**：微服务 bootstrap 加载外部配置。
    - **注意**：优先 bootstrap.yml > application.yml。


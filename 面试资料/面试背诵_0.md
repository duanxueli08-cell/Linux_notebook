

K8s 升级怎么做？

Ingress 崩了怎么止血？

MySQL 主库挂了怎么切？

段先生，我看你简历里写了负责 K8s 集群的维护。你提到了处理过 **Pod 频繁重启** 的问题 ？

除了 OOM 之外，在你的实际工作中，还遇到过哪些导致 Pod 处于 `CrashLoopBackOff` 或 `Pending` 状态的原因？

---

请问 `OOM Killed` 是 K8s 杀的还是 Linux 内核杀的？错误代码是多少？

堆外内存（Off-heap）泄漏你是怎么看出来的？Prometheus 默认只能监控 JVM 的 Heap 内存，堆外内存你是配置了什么指标才看到的？还是进容器用的什么命令？

```powershell
OOM Killed 通常是 Exit Code 137。

关于堆外内存：你要说是通过观察 Container Memory Usage（容器整体内存）一直在涨，但 JVM Heap Memory（堆内存）却很平稳，两者差距越来越大，才推断是堆外内存（如 NIO Direct Buffer）的问题。
```



你用了 HostPath，那如果 K8s 把这个 Slave Pod 调度到了**另一台** Node 上怎么办？那台 Node 上没有这个缓存，岂不是又要重新下载？你的构建速度怎么保证稳定？

```powershell
方案A（硬刚）： 我们配置了 NodeAffinity（节点亲和性），把构建任务固定在某几台特定的“构建机器”上。

方案B（更高级）： 其实更好的方案是使用 PVC 挂载 NFS 或 Ceph，但为了性能（NFS I/O 慢），我们选择了固定节点的本地盘方案。
```



本地机房和阿里云 VPC 是怎么通的？



K8s 里的 Pod 要访问公网（比如调微信支付接口），怎么出去的？





### 💡 面试官一定会问的“防身术” (必须背下来)

这份简历里我埋了几个具体的“坑”，是为了引导面试官问你这些问题。只要你背下来，面试官会觉得你很有经验。

#### 1. 关于项目一中的 `OOMKilled` (内存溢出)

- **面试官问：** “你遇到的 OOM 问题，JVM 参数具体是怎么配的？”
- **你的回答：** “当时开发给 Java 进程配的堆内存是 2G (`-Xmx2g`)，但是我 K8s 的容器 Limit 也限制了 2G。因为 Java 进程除了堆内存，还需要非堆内存（MetaSpace、线程栈等），所以加起来肯定超过 2G，就被 K8s 杀掉了。 **解决办法：** 我把 K8s 的 Limit 调大到 3G，或者让开发把堆内存降到 1.5G，预留出 20%-30% 的缓冲空间。”

#### 2. 关于项目一中的 `inode 耗尽`

- **面试官问：** “为什么镜像没清理会导致 inode 耗尽？”
- **你的回答：** “Docker 的每一层（Layer）和容器的文件系统在 Linux 上都是以文件形式存在的，尤其是这是个老集群，小文件特别多。虽然磁盘空间（Block）可能还有剩，但存放文件元数据的 inode 用光了，系统就写不进数据了。 **解决办法：** 我写了个脚本 `docker system prune -a --filter "until=24h"`，每天凌晨清理超过24小时的无用镜像。”

#### 3. 关于项目三中的 `Filebeat 多行合并`

- **面试官问：** “Filebeat 怎么处理 Java 报错的那一长串日志的？”
- **你的回答：** “如果不处理，Java 的报错（Stack Trace）会被拆成几十行，在 Kibana 里看很痛苦。我在 Filebeat 的 `filebeat.yml` 里配了 `multiline`。逻辑是：如果一行**不是**以时间戳（比如 `2025-`）开头的，就把这行拼接到上一行后面。这样一整个报错就是一条完整的日志了。”

#### 4. 关于项目二中的 `Maven 缓存`

- **面试官问：** “Jenkins 构建慢，你挂载缓存是怎么做的？”
- **你的回答：** “我们用的是 Docker 或者是 K8s 的 Slave 节点。每次起一个新的 Slave 容器，如果不挂载，Maven 都要去中央仓库下 Jar 包，特别慢。我在宿主机上搞了个 `/data/maven-repo` 目录，通过 `-v` 挂载到 Slave 容器的 `/root/.m2` 目录下。这样第二次构建时，直接用宿主机的缓存，速度就快了。”



---



### 第一部分：死磕项目细节 (最容易露馅的地方)

这部分是面试官用来验证你“是不是真干过”的，必须答得具体。

#### Q1: 你在简历里写镜像体积减少了 60%，具体是怎么做的？(必问)

**答案：** “主要是用了 **多阶段构建 (Multi-stage builds)**。 以前的 Dockerfile 是把源码和 Maven 环境都打包进去，基础镜像还是 CentOS，打出来有 800多兆。 优化后，我在第一阶段编译，第二阶段只把编译好的 Jar 包拷贝过去，运行时的基础镜像换成了 **Alpine** 版本的 JRE（只有 80多兆）。这样去掉了源码、Maven 和系统缓存，体积直接降到了 200兆左右，缩减效果很明显。同时也利用了 Docker 的**分层缓存机制**，只拉取变动的代码层，所以发布速度快了很多。”

#### Q2: 你提到的 OOM 问题，怎么排查的？最后怎么解决的？(核心亮点)

**答案：** “当时是有个 Java 服务，运行一段时间容器就重启。

1. 我先用 `kubectl get pod` 发现重启次数在增加。
2. 用 `kubectl describe pod` 查看上一个容器的状态，看到 Reason 是 **OOMKilled**，Exit Code 是 **137**，这就确认是内存溢出了。
3. 我去对比了 YAML 里的 `resources.limits.memory` 设置的是 2G，但开发给 JVM 的 `-Xmx` (堆内存) 也配了 2G。
4. **原因：** Java 进程除了堆内存，还有非堆内存（元空间、线程栈等），加起来肯定超 2G，就被 K8s 杀掉了。
5. **解决：** 我把 K8s 的 limit 调大到了 3G，同时建议开发把 JVM 堆内存降到 1.5G，预留出 buffer 空间，之后就稳定了。”

#### Q3: 你的 Jenkins 流水线里，构建速度从 15分钟 优化到 5分钟，怎么做到的？

**答案：** “瓶颈主要卡在 Maven 下载依赖包上。 因为 Jenkins 跑在容器里，每次构建启动一个新的 Slave 容器，本地仓库（Local Repository）是空的，都要去外网下包。 **解决办法：** 我在宿主机上映射了一个目录（比如 `/data/maven-repo`），通过 `-v` 挂载到 Slave 容器的 `/root/.m2` 目录下。这样所有 Slave 共享宿主机的缓存，只有新的依赖才需要下载，速度一下子就提上来了。”

#### Q4: 监控里你提到的“告警降噪”具体配置了什么规则？

**答案：** “主要用了 Alertmanager 的 **分组 (Grouping)** 和 **抑制 (Inhibition)**。 比如，当一台 Node 节点宕机（Down）的时候，这台机器上所有的 Pod 肯定都会报警。如果不做处理，我会收到几十条 Pod 报警，把手机炸了。 我配了抑制规则：**如果收到了 Node Down 的告警，就抑制住该节点上所有 Pod 相关的告警**。这样我只会收到一条核心的‘机器宕机’通知，处理起来更专注。”

------

### 第二部分：Kubernetes 技术基础 (硬核知识)

#### Q5: 一个 Pod 创建的全流程是什么？(经典八股文)

**答案：** (简化版，背这个就行)

1. `kubectl` 提交 YAML 给 **API Server**。
2. API Server 把数据存到 **Etcd**。
3. **Scheduler** (调度器) 发现有新 Pod，根据资源情况选择一个合适的 Node 节点。
4. 目标节点上的 **Kubelet** 收到任务，调用 **Docker/Containerd** 启动容器。
5. 启动后，Kubelet 把状态汇报给 API Server。

#### Q6: Service 和 Ingress 有什么区别？

**答案：** “**Service** 主要负责四层负载均衡（TCP/UDP），让集群内部的 Pod 可以互相访问（通过 ClusterIP）。 **Ingress** 主要是七层负载均衡（HTTP/HTTPS），它是集群流量的入口，负责根据域名（Host）和路径（Path）把外网流量转发给后端的 Service。比如我配置 `www.lemon.com` 转给前端 Service。”

#### Q7: Pod 健康检查（探针）有哪几种？区别是什么？

**答案：** “主要用两种：

1. **LivenessProbe (存活探针)：** 检查容器是不是‘死’了。如果探测失败，K8s 会**重启**容器。
2. **ReadinessProbe (就绪探针)：** 检查应用是不是‘准备好’了（比如加载完配置了）。如果探测失败，K8s **不会重启**它，但会把流量切断（不让 Service 把请求发给它），直到它恢复。”

------

### 第三部分：Linux 排错与基础 (基本功)

#### Q8: 生产环境发现服务器 CPU 飙高，你怎么办？

**答案：** “1. 先用 `top` 命令看是哪个进程占 CPU 高（按 `P` 排序）。 2. 如果是 Java 进程，我会导出线程快照（`jstack`），发给开发看是哪个线程卡死或死循环。 3. 如果是 MySQL，我会进数据库查 `show processlist` 看有没有慢 SQL。 4. 如果是系统进程，我看下 `/var/log/messages` 有没有异常报错。”

#### Q9: 常用什么 Shell 命令处理日志？比如查出访问量最高的 10 个 IP？

**答案：** “我会组合使用 `awk`, `sort`, `uniq`。 命令大概是：`awk '{print $1}' access.log | sort | uniq -c | sort -nr | head -n 10`。 意思是：先打印第一列 IP，排序，统计重复次数，再按次数倒序排，取前 10 个。”

------

### 第四部分：HR 与 软技能 (防坑指南)

#### Q10: 为什么只工作了 4 年就想离职？(虽然简历写的是至今，但你要准备离职理由)

**答案：** (不要说公司坏话！) “其实我很感谢乐檬这家公司，这几年我从传统运维转到云原生，学到了很多。但公司目前的业务架构已经比较稳定了，维护工作居多，挑战性变小。 我个人对云原生技术很有热情，希望能到一个技术氛围更浓、业务规模更大的平台去深耕，所以选择看一看机会。”

#### Q11: 你的期望薪资是多少？

**策略：**

- **面试官：** “你期望多少？”
- **你：** “结合我的 K8s 落地经验和市场行情，我期望是 **11k-12k** 左右（二线城市报价，一线加2-3k），但我更看重团队的技术氛围，薪资可以根据公司的薪酬体系谈。”

------

### ⚠️ 老哥最后的叮嘱（面试锦囊）

1. **关于“不知道”：**
   - 如果问到很偏的底层原理（比如 K8s 源码、内核参数），**不要瞎编**。
   - **话术：** “这个细节我暂时没深入研究过，我们生产环境主要还是用默认配置/官方推荐配置，目前运行挺稳定的。不过我回去会补习一下这块。”（展示务实的一面）
2. **关于“自信”：**
   - 你现在手里拿的是一套**逻辑闭环、技术落地**的 4 年经验简历。
   - 面试时，声音要大，语速要稳。**你就当自己真的在那家公司干了 4 年，天天就在搞这些 K8s 和 Jenkins。**
3. **准备环境：**
   - 这几天务必在自己的虚拟机里，把 `kubectl describe`, `top`, `docker build` 这些命令敲熟。手感有了，面试时说话底气就不一样。






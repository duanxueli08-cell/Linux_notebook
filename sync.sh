
#!/bin/bash

# 1. 自动定位：无论从哪触发，都强制进入脚本所在的目录
# 解决你“一闪而逝”找不到路径的问题
TARGET_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$TARGET_DIR"

# 2. 简单的错误检查：如果任一命令失败，则停止运行
set -e

echo "------------------------------------------"
echo "🚀 开始同步 K8S 笔记..."
echo "📍 当前工作目录: $(pwd)"
echo "------------------------------------------"

# 3. 执行 Git 指令
echo "📦 正在添加变更..."
git add .

# 4. 使用动态时间戳作为 commit message
# 即使没有改动，加上 || true 防止脚本因为 git commit 返回非零值而中断
echo "📝 正在提交记录..."
git commit -m "Auto-sync: $(date '+%Y-%m-%d %H:%M:%S')" || echo "ℹ️ 没有检测到需要提交的变更"

# 5. 推送到远程
echo "📤 正在上传到 GitHub..."
git push


echo "------------------------------------------"
echo "✅ 同步成功！数据已上传至 GitHub。"
echo "------------------------------------------"

# 1. 设置 3 秒停顿（1秒太快可能看不清，建议 3 秒，SRE 的“温柔”提醒）
# 你可以根据需要改成 sleep 1
sleep 3

# 2. 脚本结束，窗口会自动关闭
exit 0
## åˆå§‹åŒ–éƒ¨ç½²

é…ç½®é¡ºåºï¼š

åˆ‡æ¢åˆ° root ç”¨æˆ·ï¼›ä½¿åç»­æ“ä½œä¸å—æƒé™çš„é™åˆ¶ï¼›
å¼€å¯ SSH è¿œç¨‹é…ç½®ï¼›åç»­æ­¥éª¤å¯ä»¥é€šè¿‡è¿œç¨‹å·¥å…·æ“ä½œï¼›
æ·»åŠ  PS1 å˜é‡ ï¼›å…³çˆ±çœ¼ç›ï¼Œä»ä½ æˆ‘åšèµ·ï¼
è®¾ç½®è½¯ä»¶æºï¼›ä¸ºäº†å°†æ¥æ›´ä¸ºäº†ä¸‹ä¸€æ­¥ã€‚
ä¸‹è½½å¸¸ç”¨çš„è½¯ä»¶å·¥å…·ï¼›
è®¾ç½®æ—¶åŒº
è®¾ç½®æ—¶é’ŸåŒæ­¥ï¼›


Ubuntu ç³»ç»Ÿåœ¨å®‰è£…è¿‡ç¨‹ä¸­é€šå¸¸ä¸ä¼šè®¾ç½® root ç”¨æˆ·çš„å¯†ç ï¼Œä¹Ÿä¸ä¼šå¯ç”¨ root è´¦æˆ·è¿›è¡Œç›´æ¥ç™»å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒUbuntu ä½¿ç”¨ sudo å‘½ä»¤æ¥å…è®¸è¢«æˆæƒçš„ç”¨æˆ·æ‰§è¡Œéœ€è¦è¶…çº§ç”¨æˆ·æƒé™çš„æ“ä½œã€‚

```
sudo passwd root
```


### SSH é…ç½®

- å…è®¸è¿œç¨‹ç™»é™†

```powershell
ç¼–è¾‘ SSH é…ç½®æ–‡ä»¶ï¼š
vim /etc/ssh/sshd_config

ä¿®æ”¹æˆ–æ·»åŠ ä»¥ä¸‹å‚æ•°ï¼š
# å…è®¸ root ç™»å½•
PermitRootLogin yes
# å¦‚æœéœ€è¦å¯†ç è®¤è¯ï¼ˆå¯é€‰ï¼‰
PasswordAuthentication yes

é‡å¯ SSH æœåŠ¡ï¼š
systemctl restart ssh

æ£€éªŒ
# æ£€æŸ¥é…ç½®è¯­æ³•
sudo sshd -t
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status ssh
ss  -tunlp | grep 22
```

### PS1 å˜é‡

- ä¿®æ”¹ä¸»æœºåç§°
- ä¿®æ”¹IPåœ°å€
- å®šä¹‰ç»ˆç«¯å‘½ä»¤æç¤ºç¬¦çš„æ˜¾ç¤ºæ ¼å¼å’Œé¢œè‰² ( æ³¨æ„ä¸è¦æ”¾ç½®åœ¨shellè¯­å¥ä¸­ )

```powershell
æ°¸ä¹…ç”Ÿæ•ˆï¼ˆæ·»åŠ åˆ° ~/.bashrcï¼‰
# æ ¼å¼ï¼š[ç”¨æˆ·å@ä¸»æœºå:/å½“å‰/å®Œæ•´/è·¯å¾„]$
cat >> /root/.bashrc <<eof
PS1='[\[\e[1;31m\]\u@\h\[\e[0m\]:\[\e[1;35m\]\w\[\e[0m\]]\\$'
eof

é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
. ~/.bashrc

é¢œè‰²ä»£ç ï¼š
\[\e[1;31m\] - äº®çº¢è‰²
\[\e[1;35m\] - äº®ç´«è‰²
\[\e[0m\] - é‡ç½®é¢œè‰²
å†…å®¹å˜é‡ï¼š
\u - å½“å‰ç”¨æˆ·å
\h - ä¸»æœºå
\w - å½“å‰å·¥ä½œç›®å½•çš„å®Œæ•´è·¯å¾„
\$ - æ™®é€šç”¨æˆ·æ˜¾ç¤º$ï¼Œrootç”¨æˆ·æ˜¾ç¤º#
```


### æ°¸ä¹…ä¿®å¤ DNS

#### Netplan
ï¼ˆUbuntu 24.04 é»˜è®¤ï¼‰
ç¼–è¾‘ Netplan é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ  nameservers å­—æ®µï¼Œä¾‹å¦‚ï¼š

```
vi /etc/netplan/50-cloud-init.yaml 
network:
  version: 2
  ethernets:
    eth0:               # æ›¿æ¢ä¸ºä½ çš„ç½‘å¡åï¼ˆç”¨ ip a æŸ¥çœ‹ï¼‰
      dhcp4: true
      nameservers:
        addresses: [8.8.8.8, 114.114.114.114]
```
ç„¶ååº”ç”¨é…ç½®ï¼š
```
sudo netplan apply
```


### è½¯ä»¶æº

ubuntu

- **noble** - Ubuntu 24.04 LTS (Noble Numbat) - **æœ€æ–° LTS ç‰ˆæœ¬**

- **jammy** - Ubuntu 22.04 LTS (Jammy Jellyfish) - å½“å‰ç¨³å®š LTS ç‰ˆæœ¬

- **focal** - Ubuntu 20.04 LTS (Focal Fossa) - è¾ƒæ—§ LTS ç‰ˆæœ¬

```powershell
# æ˜¾ç¤ºæ‰€æœ‰å·²é…ç½®çš„è½¯ä»¶æº
apt policy
# æŸ¥çœ‹ä¸»è½¯ä»¶æºé…ç½®
cat /etc/apt/sources.list
# æŸ¥çœ‹æ‰€æœ‰é¢å¤–çš„è½¯ä»¶æºæ–‡ä»¶
ls -la /etc/apt/sources.list.d/
# æŸ¥çœ‹æŸä¸ªå…·ä½“æºæ–‡ä»¶çš„å†…å®¹ (ä¹Ÿå¯èƒ½æ˜¯åˆ«çš„åå­—ï¼)
cat /etc/apt/sources.list.d/ubuntu.sources

æŸ¥çœ‹å½“å‰ç³»ç»Ÿç‰ˆæœ¬
cat /etc/os-release
```

ç¼–è¾‘è½¯ä»¶æºçš„é…ç½®æ–‡ä»¶

```powershell
# Ubuntu é»˜è®¤åœ¨ /etc/apt/sources.list ä¸­å·²ç»æœ‰ä¸€ä»½æ—§æ ¼å¼çš„æºã€‚å¦‚æœä½ ä¸åˆ æ‰æˆ–æ³¨é‡Šæ‰åŸæ–‡ä»¶ï¼Œæ‰§è¡Œ apt update æ—¶ä¼šå› ä¸ºâ€œé‡å¤é…ç½®â€è€ŒæŠ¥è­¦å‘Šã€‚
mv /etc/apt/sources.list /etc/apt/sources.list.bak

# å°†åŸæ¥çš„è½¯ä»¶æºæ–‡ä»¶æ”¹åä¸ºubuntu.sources.bakï¼Œæ–°å»ºä¸€ä¸ªubuntu.sourcesæ–‡ä»¶
cat > /etc/apt/sources.list.d/ubuntu.sources << eof
Types: deb
URIs: https://mirrors.aliyun.com/ubuntu/
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

Types: deb
URIs: https://mirrors.aliyun.com/ubuntu/
Suites: noble-security
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
eof

æˆ–è€…ä¿®æ”¹å…³é”®ç‚¹ï¼š
cat /etc/os-release    # æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯
sed -i  "s@URIs:.*@URIs: http://mirrors.aliyun.com/ubuntu/@" "/etc/apt/sources.list.d/ubuntu.sources"
sed -i  "s@$VERSION_CODENAME@noble@g" "/etc/apt/sources.list.d/ubuntu.sources"

# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update
# æ£€æŸ¥ä¸‹è½½é€Ÿåº¦
sudo apt install -y wget curl
# æŸ¥çœ‹å¯æ›´æ–°è½¯ä»¶åŒ…
apt list --upgradable
```

### å¸¸ç”¨è½¯ä»¶åŒ…ä¸‹è½½

  - ```powershell
    # æŸ¥è¯¢è½¯ä»¶åŒ…ä¿¡æ¯ï¼ˆåŒ…æ‹¬æœªå®‰è£…çš„ï¼‰
    dpkg -l | grep è½¯ä»¶åŒ…åç§°
    
    # æœç´¢åŒ…å«å…³é”®å­—çš„è½¯ä»¶åŒ…
    apt search è½¯ä»¶åŒ…åç§°
    
    # æŸ¥çœ‹è½¯ä»¶åŒ…æ˜¯å¦å­˜åœ¨åŠè¯¦ç»†ä¿¡æ¯
    apt show è½¯ä»¶åŒ…åç§°
    
    # æ£€æŸ¥è½¯ä»¶åŒ…æ˜¯å¦åœ¨ä»“åº“ä¸­
    apt list è½¯ä»¶åŒ…åç§°
    
    # æ¨¡æ‹Ÿå®‰è£…ï¼ŒæŸ¥çœ‹ä¾èµ–å’Œæ˜¯å¦å¯ç”¨
    apt install -s è½¯ä»¶åŒ…åç§°
    ```

```powershell
ä¸‹è½½
apt install -y \
  wget curl tree bash-completion \
  network-manager net-tools iputils-ping \
  vim unzip

apt install -y dnsutils

ç½‘ç»œå·¥å…·
wget - å‘½ä»¤è¡Œä¸‹è½½å·¥å…·
curl - ç½‘ç»œæ•°æ®ä¼ è¾“å·¥å…·
nmcli - NetworkManager å‘½ä»¤è¡Œå·¥å…·
net-tools - ä¼ ç»Ÿç½‘ç»œå·¥å…·ï¼ˆifconfigã€netstatç­‰ï¼‰
iputils-ping - ping å‘½ä»¤

ç³»ç»Ÿå·¥å…·
tree - æ ‘çŠ¶æ˜¾ç¤ºç›®å½•ç»“æ„
bash-completion - Bash è‡ªåŠ¨è¡¥å…¨
vim - æ–‡æœ¬ç¼–è¾‘å™¨
unzip - ZIP å‹ç¼©åŒ…è§£å‹
```



### è®¾ç½®æ—¶åŒº

```powershell
# è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·
sudo timedatectl set-timezone Asia/Shanghai
# éªŒè¯è®¾ç½®
timedatectl
```


### **åŒæ­¥ç³»ç»Ÿæ—¶é—´** 

```powershell
# æ–¹æ³•ä¸€ï¼šä½¿ç”¨ timedatectl
# å®‰è£… NTP æœåŠ¡ï¼ˆå¦‚æœæœªå®‰è£…ï¼‰
sudo apt install systemd-timesyncd
# å¯ç”¨å¹¶å¯åŠ¨æ—¶é—´åŒæ­¥
sudo timedatectl set-ntp true
# æ£€æŸ¥çŠ¶æ€
timedatectl status

#æ–¹æ³•äºŒï¼šä½¿ç”¨ ntpdate å¼ºåˆ¶åŒæ­¥ï¼ˆæ¨èï¼‰
# å®‰è£… ntpdate
sudo apt install ntpdate
# å¼ºåˆ¶åŒæ­¥æ—¶é—´ï¼ˆä½¿ç”¨é˜¿é‡Œäº‘NTPæœåŠ¡å™¨ï¼‰
sudo ntpdate -u ntp.aliyun.com
```


```

æŸ¥çœ‹å½“å‰ç³»ç»Ÿæ¶æ„

```powershell
uname -m
dpkg --print-architecture
```


### æ›´æ”¹ç½‘å¡åç§°

ä»¥ Ubuntu 2404 ç³»ç»Ÿä¸ºä¾‹ï¼
âœ… ç›®æ ‡
- å°†å½“å‰ç½‘å¡ ens33 æ”¹ä¸º eth0
- ç¦ç”¨å¯é¢„æµ‹å‘½åè§„åˆ™ï¼Œä½¿æ–°ç½‘å¡å‘½åä¸º eth1ã€eth2...
- ç¡®ä¿ç³»ç»Ÿå¯åŠ¨åç”Ÿæ•ˆ

æ–¹æ³•ï¼šé€šè¿‡å†…æ ¸å‚æ•° + udev è§„åˆ™
```
# ç¡®è®¤å½“å‰ç½‘å¡ MAC åœ°å€
ip link show ens33
# åˆ›å»º udev è§„åˆ™æ–‡ä»¶ï¼ˆå¼ºåˆ¶å‘½åï¼‰ï¼ˆæ›¿æ¢ä¸ºä½ çš„ MACï¼‰ï¼š
vi /etc/udev/rules.d/70-persistent-net.rules
SUBSYSTEM=="net", ACTION=="add", DRIVERS=="?*", ATTR{address}=="00:0c:29:11:07:c8", NAME="eth0"
```
- è¿™ä¸ªæ–‡ä»¶å 70-persistent-net.rules æ˜¯çº¦å®šä¿—æˆçš„ï¼Œè™½ç„¶æ—§ç‰ˆå·²å¼ƒç”¨ï¼Œä½†åœ¨ç°ä»£ systemd ä¸­ä»æœ‰æ•ˆï¼ˆåªè¦è§„åˆ™è¯­æ³•æ­£ç¡®ï¼‰

ç¦ç”¨å¯é¢„æµ‹å‘½å
```
# ä¿®æ”¹ GRUB å†…æ ¸å¯åŠ¨å‚æ•°
sed -i 's/GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0 /' /etc/default/grub
# æ›´æ–° GRUB é…ç½®
update-grub
```

æ›´æ–° initramfs
```
# ç¡®ä¿æ–°è§„åˆ™åœ¨æ—©æœŸå¯åŠ¨é˜¶æ®µç”Ÿæ•ˆ
sudo update-initramfs -u
```

é‡å¯ç³»ç»Ÿ
```
reboot
```

ğŸ“Œ è¡¥å……è¯´æ˜
- â“ä¸ºä»€ä¹ˆä¸ç”¨ Netplan ç›´æ¥æ”¹åï¼Ÿ
	- Netplan ä¸èƒ½é‡å‘½åæ¥å£ï¼Œå®ƒåªèƒ½é…ç½®å·²æœ‰æ¥å£ã€‚é‡å‘½åå¿…é¡»åœ¨å†…æ ¸/udev å±‚å®Œæˆã€‚



### SSH å¯†é’¥

> å¹³æ—¶å¤§éƒ½æ˜¯é€šè¿‡ windows ç³»ç»Ÿæ“ä½œï¼Œæ‰€ä»¥æˆ‘å°±åœ¨ windows ç³»ç»Ÿç”Ÿäº§å¯†é’¥å¯¹ï¼Œå°†å…¬é’¥å‘é€ç»™è¢«æ§åˆ¶ç«¯çš„è®¾å¤‡ï¼

```powershell
# æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ .ssh ç›®å½•
ls $env:USERPROFILE\.ssh

# æŸ¥çœ‹å¯†é’¥æ–‡ä»¶
ls $env:USERPROFILE\.ssh\id_*.pub
```

å¦‚æœæ²¡æœ‰å¯†é’¥å¯¹ï¼Œé€šè¿‡ä¸‹é¢çš„æ­¥éª¤å®Œæˆï¼›

```powershell
ssh-keygen -t ed25519 -C "shirley@shenzhou.notebook"
# ä¸€è·¯å›è½¦ï¼ˆé»˜è®¤å­˜åˆ° .ssh\id_ed25519ï¼‰

# -t ed25519 = å½“ä»£é»„é‡‘æ ‡å‡†ï¼ˆå¿«ã€å°ã€ç¡¬ï¼‰
# -C "xxx" = ç»™å…¬é’¥è´´æ ‡ç­¾ï¼ˆæ–¹ä¾¿ç®¡ç†ï¼Œéå¯†ç ï¼‰
# ç©º passphrase = æŠŠå®¶é—¨é’¥åŒ™æ‰”åœ¨é—¨å£ â€”â€” æ°¸è¿œè®¾ä¸€ä¸ª
```

æœ€åå°†ç”Ÿæˆçš„å…¬é’¥æ‹·è´åˆ°è¢«æ§åˆ¶çš„è®¾å¤‡ä¸­

```
type $env:USERPROFILE\.ssh\id_ed25519.pub | ssh root@10.0.0.61 "mkdir -p ~/.ssh && chmod 700 ~/.ssh && cat >> ~/.ssh/authorized_keys && chmod 600 ~/.ssh/authorized_keys"
```

**ç”±äºæ˜¯windows ç³»ç»Ÿï¼Œåœ¨è¿›è¡Œæ–‡æœ¬ä¼ è¾“æ—¶ä¼šæ¶‰åŠåˆ°ä¸€äº›éšè—å­—ç¬¦ï¼Œä¸€å®šè¦æ³¨æ„æœ€åçš„æ£€æŸ¥å“¦ï¼ï¼ï¼**

```
cat -A ~/.ssh/authorized_keys

# å¦‚æœæœ‰éšè—å­—ç¬¦ä½œç¥Ÿï¼Œç”¨è¿™ä¸ªæŒ‡ä»¤å¿«é€Ÿè§£å†³
sed -i 's/^.*ssh-ed25519/ssh-ed25519/' ~/.ssh/authorized_keys
```





### æœ€ååˆ«å¿˜äº†åšå¿«ç…§å“¦ï¼

### 理论概念

#### Nginx

`nginx.conf` 的配置由 **三大块**组成：

```powershell
1、全局块
Nginx 运行环境（用户、进程、日志等）
user  nginx;               # 运行 Nginx 的用户
worker_processes auto;     # 工作进程数，通常与 CPU 核心数一致
error_log  /var/log/nginx/error.log warn;  # 错误日志
pid        /var/run/nginx.pid;             # 进程 PID 文件
```

```powershell
2. events 块
作用范围：影响 Nginx 的网络连接处理。
events {
    worker_connections 1024;  # 每个 worker 进程允许的最大连接数
    use epoll;                # 事件驱动模型（Linux 推荐 epoll）
}
```

```powershell
3. http 块
作用范围：Nginx 的核心，定义 Web 服务配置。
内部可以包含 server 块，每个 server 再细分 location。
http {
    include       /etc/nginx/mime.types;   # 引入文件类型映射
    default_type  application/octet-stream;
    access_log    /var/log/nginx/access.log  main;
    sendfile      on;
    keepalive_timeout 65;

    # 虚拟主机配置
    server {
        listen       80;                # 监听端口
        server_name  www.example.com;   # 域名

        location / {
            root   /usr/share/nginx/html;  # 网站根目录
            index  index.html index.htm;
        }

        location /images/ {
            root   /data;
        }

        error_page  404 /404.html;
    }
}

```



#### Ansible



###### playbook 自动化

> YAML是一种对象描述性语言，它有两种基本样式：Maps和Lists。
>
> **Ansible Playbook 四大核心组成部分**
>
> 1. **目标 (Target)** - **【必备】**
>    - **功能**：定义在**哪些主机**上执行任务。
>    - **关键属性**：`hosts` (目标主机/组)。
> 2. **任务 (Task)** - **【必备】**
>    - **功能**：定义具体要执行的**操作列表**，是Playbook的核心。
>    - **关键属性**：`tasks` (任务列表)，每个任务使用一个Ansible模块。
> 3. **变量 (Variable)** - **【可选】**
>    - **功能**：定义所需**变量**，使配置变得灵活。
>    - **关键属性**：`vars`。
> 4. **处理程序 (Handler)** - **【可选】**
>    - **功能**：定义**触发式任务**，仅在由其他任务通知时才会执行，常用于服务重启。
>    - **关键属性**：`handlers`。
>
> **一句话总结：一个Playbook必须指明“在哪儿干”（目标）和“干什么”（任务），而“灵活地干”（变量）和“收尾工作”（处理程序）则是可选的增强部分。**

注意事项

> YAML对格式非常敏感，以下是常见的注意事项：
>
> #### 1. **缩进规则**
>
> - **必须使用空格**，不能使用Tab键
> - **推荐使用2个空格**作为缩进（Ansible社区标准）
> - **同一层级的内容必须对齐**
>
> #### 2. **冒号后的空格**
>
> - 键值对的冒号后面**必须有一个空格**
>
> #### 3. **短横线后的空格**
>
> - 列表项的短横线 `-` 后面**必须有一个空格**
>
> #### 4. **多行字符串**
>
> **竖线 `|`**（保留换行符）：
>
> ```powershell
> config_file: |
>   server {
>       listen 80;
>       server_name example.com;
>       root /var/www/html;
>   }
> # 会保留所有换行和缩进
> ```
>
> **大于号 `>`**（折叠换行符，将多行连接为一行）：
>
> ```powershell
> description: >
>   这是一段很长的描述文本，
>   它会被折叠成一行，
>   只在原换行处保留空格。
> # 输出："这是一段很长的描述文本， 它会被折叠成一行， 只在原换行处保留空格。"
> ```
>
> #### 5. **字符串引号**
>
> - 通常不需要引号，但在特殊字符时需要使用
> - 双引号 `"` 会解释转义字符，单引号 `'` 不会

```powershell
1. Maps（键值对）
Maps 用于表示键值对集合，也就是在其他编程语言中被称为“字典”、“哈希”或“对象”的东西。
语法：使用 key: value 的形式，冒号后面必须有一个空格。
作用：描述一个对象的属性。

一个简单的Map，描述一个人：
name: 张三
age: 30
job: 工程师

嵌套Map（复杂对象）：
Map的值可以是另一个Map，通过缩进来表示层级关系。
person:
  name: 李四
  age: 25
  address:
    city: 北京
    street: 长安街
    zipcode: 100000
```

```powershell
2. Lists（列表）
Lists 用于表示一组按顺序排列的值，也就是“数组”或“列表”。
语法：每个元素以短横线 - 开头，并且 - 后面必须有一个空格。
作用：描述一个序列。

一个简单的列表，表示一个人的爱好：
hobbies:
  - 阅读
  - 跑步
  - 游泳
  
Map和List的组合：
这是YAML最强大的地方，可以构建非常复杂的数据结构。
---
- name: 配置并启动Nginx服务  # 一个Play的描述
  hosts: webservers         # 操作的目标主机组
  become: yes               # 使用特权权限（如sudo）

  tasks:                    # 任务列表
    - name: 确保Nginx软件包已安装 # 第一个任务
      yum:                  # 使用yum模块（针对CentOS/RHEL）
        name: nginx
        state: latest

    - name: 确保Nginx服务是启动状态 # 第二个任务
      service:              # 使用service模块
        name: nginx
        state: started
        enabled: yes        # 设置开机自启
```

###### 

#### OSI

| OSI 七层模型           | TCP/IP 四层模型       | 常见协议       |
| ---------------------- | --------------------- | -------------- |
| 应用层、表示层、会话层 | 应用层                | HTTP, FTP, DNS |
| 传输层                 | 传输层                | TCP, UDP       |
| 网络层                 | 网际层（Internet 层） | IP, ICMP       |
| 数据链路层 + 物理层    | 网络接口层            | Ethernet, ARP  |

> 网络层协议：IP、ICMP、ARP（严格说 ARP 在链路层和网络层之间）

#### 初始化环境部署

##### PS1 变量解释

```powershell
PS1 变量解释

\[\e[36m\]：开始颜色设置
\e[36m：设置颜色为青色
\[ 和 \]：告诉 Bash 这是非打印字符，用于正确计算提示符长度

\u@\h \W：提示符内容
\u：当前用户名
@：字面量的 @ 符号
\h：主机名（短名称）
\W：当前工作目录的基名（最后一级目录名）

\[\e[0m\]：重置颜色
\e[0m：重置所有文本属性（颜色、粗体等）

30-37：黑、红、绿、黄、蓝、洋红、青、白
40-47：背景色
1：粗体
0：重置

PS1='\[\e[1;32m\]\u@\h\[\e[0m\]:\[\e[1;34m\]\w\[\e[0m\]\$ '
```

##### 更换软件源

###### rocky系列

```powershell
rocky系统更换至阿里源
root@rocky9-10:/etc/yum.repos.d# cat rocky.repo 

[BaseOS]
name=Rocky Linux 9.5-BaseOS
baseurl=https://mirrors.aliyun.com/rockylinux/9/BaseOS/x86_64/os/
enabled=1
gpgcheck=0

[AppStream]
name=Rocky Linux 9.5-AppStream
baseurl=https://mirrors.aliyun.com/rockylinux/9/AppStream/x86_64/os/
enabled=1
gpgcheck=0

[epel]
name=Rocky Linux 9.5-epel
baseurl=https://mirrors.aliyun.com/epel/9/Everything/x86_64/
enabled=1
gpgcheck=0

# 1. 清理 yum 缓存
dnf clean all

# 2. 重新生成缓存
dnf makecache

# 3. 验证仓库
dnf repolist

# 查看已启用的仓库（可选）
dnf repolist enabled
```

###### Ubuntu系列

```powershell

root@ubuntu2404-30:/etc/apt/sources.list.d# cat ubuntu.sources
Types: deb
URIs: http://mirrors.aliyun.com/ubuntu
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 更新软件源
apt update

# 检查可用的软件源
apt policy

各组件说明
Suites:

noble: 主仓库（Ubuntu 24.04）

noble-updates: 重要更新

noble-backports: 向后移植的软件包

noble-security: 安全更新

Components:

main: 官方支持的免费开源软件

restricted: 官方支持但非完全自由的软件

universe: 社区维护的免费开源软件

multiverse: 有版权或法律限制的软件

额外建议
如果您在中国大陆，还可以考虑其他镜像源：
# 清华镜像源
URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu

# 华为镜像源  
URIs: https://mirrors.huaweicloud.com/ubuntu

# 腾讯镜像源
URIs: https://mirrors.cloud.tencent.com/ubuntu

补充：
代号	Ubuntu 版本	发布日期	支持截止
noble	24.04 LTS	2024年4月	2029年4月
jammy	22.04 LTS	2022年4月	2027年4月
focal	20.04 LTS	2020年4月	2025年4月
可以通过
hostnamectl
cat /etc/os-release
这两个指令任意一个查看当前系统的版本号！
```



#### Keepalived

##### 配置介绍：

```powershell
keepalived默认配置文件主要有三部分组成：
global_defs、vrrp_instance、virtual_server
其中最重要的配置内容是vrrp_instance，在这个配置段中，设置了我们keepalived对外提供的统一入口。

global_defs - 全局配置段
在这部分的配置段中，我们暂时只需要关心router_id即可
router_id 			# 每个keepalived主机唯一标识，建议使用当前主机名

vrrp_instance - vrrp配置段
在这部分的配置段中，我们选优关心以下几处的配置信息：
state 				描述keepalived主机间的角色定位的，一般只有两个值MASTER、BACKUP
interface 			指定在哪个网卡上绑定VIP
virtual_router_id 	指定VIP的唯一标识，在keepalived集群中，此配置必须一致。
priority 			# 当前物理节点在此虚拟路由器的优先级，以此判断哪个router_id作为主路由，值越大，优先级越高
authentication 		多个路由之间通信的认证
virtual_ipaddress 	指定VIP的地址，可以是多个。

virtual_server - vs配置段
在这部分的配置段中，我们主要关系一下几处的配置信息：
lb_algo 			定制算法信息
protocol 			数据通信协议的定制
real_server 		后端真实主机的定制
```



```powershell
ubuntu24-13 主机部署nginx服务

apt install nginx rsyslog -y

echo 'keepalived master' > /var/www/html/index.nginx-debian.html

curl localhost

vi /etc/netplan/50-cloud-init.yaml
network:
version: 2
ethernets:
ens33:
addresses:
- 10.0.0.13/24
nameservers:
addresses:
- 10.0.0.2
search: []
routes:
- to: default
via: 10.0.0.2
ens37:
addresses:
- 192.168.8.13/24

netplan apply

另一台keepalived主机
vi /etc/netplan/50-cloud-init.yaml
network:
version: 2
ethernets:
ens33:
addresses:
- 10.0.0.16/24
nameservers:
addresses:
- 10.0.0.2
search: []
routes:
- to: default
via: 10.0.0.2
ens37:
addresses:
- 192.168.8.16/24

netplan apply

设定主keepalived配置文件
vi /etc/keepalived/keepalived.conf
global_defs {
router_id kpmaster
}
vrrp_instance VI_1 {
state MASTER
interface ens37
virtual_router_id 50
priority 100
authentication {
auth_type PASS
auth_pass 1111
}
virtual_ipaddress {
192.168.8.100
}
}

systemctl restart keepalived.service

ip a

设定从keepalived配置文件
root@ubuntu24-16:~# cat /etc/keepalived/keepalived.conf
global_defs {
router_id kpslave
}
vrrp_instance VI_1 {
state BACKUP
interface ens37
virtual_router_id 50
priority 99
authentication {
auth_type PASS
auth_pass 1111
}
virtual_ipaddress {
192.168.8.100
}
}
```



#### Zabbix

```powershell
组件解析
Zabbix Server		接收所有重要信息数据的中央组件，它存储了软件架构的所有配置。
DatabaseStorage		所有配置信息以及Zabbix收集的数据都存储在数据库中
web Server			是Zabbix服务器的一部分，其目的是为了更轻松便捷访问Zabbix Server，它通常(但不一定)与Zabbix Server运行在同一台物理机上。
proxy				可以代表Zabbix Server收集客户端节点性能和可用性数据。一般在大集群场景下部署。
Agent				Zabbix代理部署在客户端目标节点主机上，以主动模式收集节点数据并报告给Zabbix Server。

zabbix-server-mysql # Zabbix Server服务器包
zabbix-frontend-php # Zabbix 前端Web服务包,本质为LAP
abbix-apache-conf # Zabbix 前端Web服务配置包,本质为LAP
zabbix-agent # Zabbix 客户端包
zabbix-agent2 # Zabbix 客户端包
zabbix-get # Zabbix 服务测试包

```



#### DNS

1. **理解原理**：递归、迭代、各种记录类型。
2. **吃透配置**：`named.conf 的结构（options, zone）和区域文件的写法（尤其是 SOA）。
3. **掌握工具**：**`dig`** 必须熟练使用，`rndc` 要会常用命令

##### 原理

> ICANN为不同的国家或地区设置了相应的顶级域名，这些域名通常都由两个英文字母组成。
>
> 例如：.uk代表英国、.fr代表法国、.jp代表日本。中国的顶级域名是.cn，.cn下的域名由CNNIC进行管理。

> Linux 域名解析过程是：
> 应用 → 查 /etc/hosts` → 查 /etc/resolv.conf 指定的 DNS → DNS 服务器递归查询 → 返回 IP → 缓存。

```powershell
	RedHat 和 Rocky （以及其他基于 RHEL 的发行版）默认不使用 systemd-resolved ，需要单独安装服务。核心在于企业级发行版对稳定性、兼容性和运维习惯的优先考量。
	Ubuntu系统默认使用systemd-resolved，它作为 systemd 组件的一部分，与系统初始化、服务管理、日志系统等深度集成，便于统一配置和监控。
	对于Centos|Rocky系列的操作系统来说，他们的dns可以直接在 /etc/resolv.conf文件中进行配置。但是在ubuntu环境中，虽然在网卡中配置了 DNS 服务器的IP地址，但在使用相关命令进行 DNS 解析时，默认的 DNS 服务器使用的是 127.0.0.53，而并不是我们在网卡上配置的DNS 服务器地址,而是来源于
stub-resolv.conf 文件里面的配置。

默认情况下，Centos系列的系统没有安装该服务
[root@rocky9-12 ~]# yum install systemd-resolved
[root@rocky9-12 ~]# systemctl start systemd-resolved.service
```

##### resolved

```powershell

## ✅ 总结类比（很容易记）
* /etc/resolv.conf = **门牌**（程序永远找它）
* /etc/systemd/resolved.conf = **规则说明书**（systemd-resolved 的配置文件）
* /run/systemd/resolve/stub-resolv.conf = **门卫**（127.0.0.53，本地代理）
* /run/systemd/resolve/resolv.conf = **真实电话簿**（真正的上游 DNS 列表）
```

##### 网络工具

```powershell
dig：域名信息查询工具。（dig 命令不会查询本地 hosts文件中定义的域名和IP对应关系，但是在systemd-resloved服务帮助下，会使用hosts文件里面的记录。）
host：命令可以根据域名查询得到对应的服务器IP地址。
nslookup：一个命令行下的网络工具，主要用来查询DNS记录，查看域名解析是否正常，也可用来诊断网络问题。
whois：命令是一个用于查询域名和IP地址注册信息的工具，它可以帮助用户获取有关域名或IP地址的所有者、注册商、注册日期、到期日期以及其他相关信息。
rndc：是一个用于远程管理BINDDNS服务器的工具。
Bind:具有强大的安全防护功能，包括防止DNS放大攻击、DNS欺骗和缓存污染等。它提供了强大的DNS解析功能，包括正向解析（域名到IP地址）和反向解析（IP地址到域名）。

dig www.magedu.com	# 获取完整信息
dig @114.114.114.114 www.baidu.com	#指定dns解析域名

host——输出简洁，适合快速查看
host www.magedu.com		# 根据域名找ip
host 114.116.196.150	# 根据ip找域名
host www.magedu.com 114.114.114.114		# 指定DNS服务器
host -a www.magedu.com 114.114.114.114	# 显示所有信息

nslookup——交互式查询，Windows/Linux 都可用，但功能不如 dig 强大
nslookup www.baidu.com	# 非交互式查询
nslookup			# 进入交互界面
> www.magedu.com	# 直接输入域名进行解析
> server 223.5.5.5	# 指定dns服务器
nslookup www.magedu.com 114.114.114.114		# 非交互式指定DNS服务器查询

apt install whois	|	dnf install whois
whois jd.com			# 查看域名

apt install bind9-utils -y	|	dnf install bind -y
rndc命令依赖于named服务，否则无法运行
systemctl start named.service

rndc status				# 查看BIND服务状态
rndc reload				# 重载主配置文件和区域解析库文件
```

##### 检查流程

```powershell
- 配置文件语法检查：`named-checkconf
- 区域文件语法检查：`named-checkzone`
- 网络连通性检查：防火墙是否放行了 **TCP 和 UDP 的 53 端口**（区域传输使用 TCP，普通查询多用 UDP）。
```



##### bind

- `named`：**服务进程本身**，这是核心。
- named.conf：**主配置文件**，所有配置的入口。
- 区域文件 (Zone Files)：包含特定域名的具体解析记录（如 `.db.example.com`）。
- rndc`：控制工具，用于管理运行中的 `named` 进程（重载配置、刷新缓存、状态查看等）。
- `dig` / `host` / `nslookup`：**诊断查询工具**，`dig` 是功能最强大、最常用的。

###### 开放DNS部署

```postgresql
 	dnf install bind -y		|	apt install bind9 -y
 	systemctl enable --now named
    systemctl status named	|	systemctl status named
    
	getenforce	|	setenforce	0	#临时开启0；临时关闭1
	systemctl disable --now firewalld	|	systemctl disable --now ufw
	
rocky开放dns，需要修改配置文件。
	vim /etc/named.conf		# 编辑named服务主配置文件	
options {
	listen-on port 53 { 127.0.0.1; any; }; # 增加 any;
	allow-query { localhost; any; }; # 增加 any;
systemctl restart named		#修改配置文件后，重启named服务。
	
cat	/etc/resolv.conf
    nameserver 127.0.0.53 		# 处理并转发到真实 DNS
    options edns0 trust-ad 		# 开启了 EDNS0 扩展和 DNSSEC 信任机制。
    search . 					# 不追加域名后缀，直接查询输入的域名。
    注意：
    【无论Rocky还是Ubuntu，修改resolv.conf，都是重启后还原的】
    
    yum install net-tools -y	# 下载网络工具包
    ss -tnulp | grep named
    named默认会占用TCP和UDP的53端口， 953是给rndc管理工具使用的。
    Centos主机上默认没有开启本地地址访问的能力。
```

###### Ubuntu配置解读

> root@ubuntu-s-13/etc/bind:$ls
>bind.keys  db.255    db.magedu.com             named.conf.local    zones.rfc1918
> db.0       db.empty  named.conf                named.conf.options
> db.127     db.local  named.conf.default-zones  rndc.key
> 
> `named.conf.*` → 配置用
>
> `db.*` → 区域数据库文件
>
> `bind.keys` → 安全
>
> `zones.rfc1918` → 内网反向解析
>
> > 1. **配置文件类**
>>
> >    **`named.conf`**
> >     BIND 的主配置文件，通常只负责 **include 其他配置文件**
> >
> >    **`named.conf.local`**
> >     用来写你自己定义的 **本地域（zone）** 配置
> >
> >    **`named.conf.options`**存放全局配置，比如：
> >
> >    - DNS 监听的 IP 和端口
> >    - 转发器（forwarders）
> >    - allow-query / allow-transfer 等权限控制
> >
> >    **`named.conf.default-zones`**
> >     系统自带的一些默认 zone 配置
> >
> > 2. **区域数据文件（Zone files）**
> >
> >    **`db.local`**
> >     `localhost` 的正向解析文件，把 `localhost` → `127.0.0.1`。
> >
> >    **`db.127`**
> >     本地回环地址 `127.0.0.1` 的反向解析文件，把 `127.0.0.1` → `localhost`。
> >
> >    **`db.0` / `db.255`**
> >     早期用来定义特殊网段（0.0.0.0/8、255.255.255.255/8）的反向解析，现在基本上属于历史遗留文件，很少修改。
> >
> >    **`db.empty`**
> >     一个空白的 zone 文件，用来“声明但不提供数据”，避免解析到无效地址。
> >
> >    **`db.magedu.com`**
> >     这是你新建的正向解析数据库文件，存放 `magedu.com` 域里的记录（A、CNAME、MX等）。
> >
> > 3. **安全与额外配置**
> >
> > - **`bind.keys`**
> >    存放 DNSSEC 根密钥（用于安全验证 DNS 根区域）。一般不需要动，系统更新会自动维护。
> > - **`zones.rfc1918`**
> >    定义了私有地址（10.x.x.x、192.168.x.x 等）对应的反向区域配置。
> >
> > 

```powershell
1. named.conf.local 文件中的配置：
zone "magedu.com" {
	type master;
        # 表示这是主DNS服务器对该域名负责，所有 DNS 记录都由此服务器管理。
	file "/etc/bind/db.magedu.com";
        # 指定该域名的数据库文件，也就是存储 magedu.com 域的所有 DNS 记录的文件
	allow-transfer { 10.0.0.15; };
        # 允许 IP 地址为 10.0.0.15 的服务器进行 区域传送
	allow-update { none; };	
        # 禁止动态更新，即不允许任何客户端修改 DNS 记录。
};
	
2. db.magedu.com 文件格式及配置：
$TTL    604800
# 表示默认生存时间，单位是秒，表示 DNS 记录在缓存中保存的时间。604800 秒即 7 天。
@   IN  SOA dns1.magedu.com. root.magedu.com. (
# dns1.magedu.com.：主DNS服务器的主机名;注意：它必须在该区里有对应的 A 记录，否则会报错。
# root.magedu.com.：这是管理员邮箱地址，但 @ 符号写作点号。可以自定义，但格式就是这个。

Serial Number（123）：版本号，从属DNS用它判断主DNS的数据库是否更新。每次改 zone 文件要 +1。
Refresh（3H）：从服务器多久去主服务器检查一次更新（这里是3小时）。
Retry（15M）：检查失败后，多久再尝试（这里是15分钟）。
Expire（1D）：如果主DNS长时间不可达，从服务器缓存多久后作废（1天）。
Negative TTL（1W）：当解析失败时，缓存“没有该记录”的时间（这里是1周）

    IN  NS  dns1.magedu.com.
# 这是 Name Server (NS) 记录，表示该域名的权威 DNS 服务器，负责处理该域名的查询。
    IN  NS  dns2.magedu.com.

dns1    IN  A   10.0.0.13
# 这是 A 记录，将 dns1.magedu.com 映射到 IP 地址 10.0.0.13。
dns2    IN  A   10.0.0.15
# 这是另外一个 A 记录，将 dns2.magedu.com 映射到 IP 地址 10.0.0.15。
www     IN  A   10.0.0.66
# 这是 A 记录，将 www.magedu.com 映射到 IP 地址 10.0.0.66。
*       IN  A   10.0.0.1
# 这是 通配符 A 记录，表示所有没有定义的子域名（比如 test.magedu.com、blog.magedu.com）都指向 10.0.0.1。

3. named.conf.options 文件中的配置：
options {
        directory "/var/cache/bind";
        allow-query { any; };
# 允许任何客户端发起查询请求。
        recursion yes;
# 启用递归查询。这意味着 DNS 服务器不仅可以解析自己负责的域名，还可以去其他服务器查询并返回结果。
        dnssec-validation auto;
# 启用DNSSEC验证，用于确保 DNS 响应的真实性，防止 DNS 欺骗攻击。
        listen-on-v6 { any; };
# 启用对 IPv6 地址的监听
		listen-on { any; };
# 监听所有 IPv4 地址上的 DNS 请求。
};

```

###### Rocky配置解读

> rpm -ql bind		# 查看安装文件的配置文件位置
> /etc/named.conf 	# 配置文件
> 查看默认配置		grep -Ev '//|^$' /etc/named.conf

> named.conf：通常包含全局配置和其它配置文件的引入。
>
> named.rfc1912.zones：定义的标准 DNS 区域配置
>
> named.root.key：存储 DNS 根密钥，用于 DNSSEC。DNSSEC 可以保护域名解析过程免受篡改。

```powershell

```

##### 反向解析

![image-20250904204532920](C:\Program Files\Typora\image\image-20250904204532920.png)

写法规则：`in-addr.arpa` 是反向解析的固定后缀。

前面的 `0.0.10` 是把 IP **倒序写**：10.0.0.x  →  0.0.10.in-addr.arpa

所以，这个 zone 里定义的 PTR 记录，都是 `10.0.0.X` 的反解。

而`db.*` 只是约定俗成的命名习惯，不是强制要求。

1、启用反向查找区域的专属入口：

```powershell
root@ubuntu24:~# cat /etc/bind/named.conf.default-zones
zone "0.0.10.in-addr.arpa" IN {
	type master;
	file "/etc/bind/db.0.0.10.in-addr.arpa";
};
```



2 添加反向查找区域的配置：

root@ubuntu24:~# cat /etc/bind/db.0.0.10.in-addr.arpa、

```powershell
$TTL 1D
@ IN 	SOA ptr-test. admin.magedu.com. (1 3H 15M 1D 1W)
		NS ptr.magedu.com.
	13 PTR www.magedu.com.
	12 PTR about.magedu.com.
```



3 检查配置和zone文件语法问题：

root@ubuntu24:~# named-checkconf
root@ubuntu24:~# named-checkzone 0.0.10.in-addr.arpa /etc/bind/db.0.0.10.in-addr.arpa

4 重载配置：

root@ubuntu24:~# rndc reload # 重载配置如果不生效，则重启named服务

5、 确认查询效果：

	默认的dns服务器是 10.0.0.13 主机
	root@ubuntu24:~# dig -t ptr 12.0.0.10.in-addr.arpa # 完整写法
	root@ubuntu24:~# dig -x 10.0.0.12 # 精简写法
	nslookup反解析检查：
	root@ubuntu24:~# nslookup 10.0.0.12
	host反解析检查
	root@ubuntu24:~# host 10.0.0.12
	
	如果默认dns不是10.0.0.13，而且dig、nslookup、host没有指定dns的话
	root@ubuntu24:~# dig -t ptr 12.0.0.10.in-addr.arpa
	root@ubuntu24:~# nslookup 10.0.0.12
	root@ubuntu24:~# host 10.0.0.12
##### DNS子域

子域名通过在主域名前面添加一个标识符（通常是单词或短语）来形成，被看作主域名的一部分。这种层次结构通过点号分隔，反映了子域和主域的父子关系。

![image-20250904205832159](C:\Program Files\Typora\image\image-20250904205832159.png)

1、DNS MASTER 添加两个子域的配置（bj和sh）：

```powershell
root@ubuntu24:~# cat /etc/bind/db.magedu.com
$TTL 86400
@ IN SOA magedu-dns. admin.magedu.com. ( 128 3H 15M 1D 1W )
				NS 	dns1
				NS 	dns2
bj 				NS 	bj-dns
sh 				NS 	sh-dns
dns1 			A 	10.0.0.13
dns2 			A 	10.0.0.15

www 			A 	10.0.0.14
blog 			A 	10.0.0.12
bj-dns 			A 	10.0.0.14
sh-dns 			A 	10.0.0.16
重载生效
查看从服务器，主从同步成功
```

2、bj子域DNS配置

```powershell
开启dns的其他主机正常访问
[root@bjdns ~]# vim /etc/named.conf
options {
	listen-on port 53 { 127.0.0.1; any;};
	allow-query { localhost; any;};
	
定制bj子域入口配置
[root@bjdns ~]# vim /etc/named.rfc1912.zones
zone "bj.magedu.com" IN {
	type master;
	file "db.bj.magedu.com";
};

定制bj子域zone配置
[root@bjdns ~]# vim /var/named/db.bj.magedu.com
$TTL 86400
@ IN 	SOA bj-dns. admin.bj.magedu.com. ( 1 3H 15M 1D 1W )
		NS 	bj-sub.bj.magedu.com.
bj-sub 	A 	10.0.0.14
www 	A 	22.33.44.55
test 	A 	66.77.88.99

加载配置生效
```

3、sh子域DNS配置

```powershell
```



##### 圆运动的实践

> 党参30g，炒白术30g，茯苓20g，炙甘草20g，山药30g。
> 炒白扁豆50g。
> 陈皮30g，砂仁20g，木香10g。
> 莲子10g，远志20g，合欢皮20g。
> 枸杞25g，菊花10g




```powershell
#!/bin/bash

# set -e
##############################
echo "===== 系统初始化脚本 ====="
if grep -qi rocky /etc/os-release; then
	. /etc/os-release
    OS="rocky"
    PKG_MGR="dnf"
elif grep -qi ubuntu /etc/os-release; then
    OS="ubuntu"
    PKG_MGR="apt"
else
    echo "❌ 未知系统，仅支持 Rocky / Ubuntu"
    exit 1
fi
echo "检测到系统：$OS"
##############################
echo "===== 修改网卡名为 eth0 ====="
if [ "$OS" = "rocky" ]; then
    MAC=$(ip link | awk '/ether/ {print $2; exit}')
    NIC=$(ip -o link | awk -F': ' '{print $2}' | grep -E '^(ens|eth)' | head -n1)
	cd /etc/NetworkManager/system-connections/
	mv $NIC.nmconnection eth0.nmconnection
	sed -i "s@$NIC@eth0@g" /etc/NetworkManager/system-connections/eth0.nmconnection
	sed -i -e 's/GRUB_CMDLINE_LINUX=.*/GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"/' -e 's/GRUB_ENABLE_BLSCFG=.*/GRUB_ENABLE_BLSCFG=false/' /etc/default/grub
	ls /boot/efi
	# 查看系统启动项
    if [ $? -ep 0 ]; then
	grub2-mkconfig -o /boot/efi/EFI/rocky/grub.cfg
	else
	grub-mkconfig -o  /boot/grub2/grub.cfg
	echo "Rocky 已配置网卡 eth0 (重启后生效)"
	fi
elif [ "$OS" = "ubuntu" ]; then
    # 修改 GRUB 参数 net.ifnames=0
    sed -i 's/GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0 /' /etc/default/grub
    update-grub
    echo "Ubuntu 已配置网卡 eth0 (重启后生效)"
fi
##############################
#!/bin/bash
# Rocky 与 Ubuntu 通用更换软件源脚本

echo ">>> 检测系统类型..."

if [ -f /etc/os-release ]; then
    . /etc/os-release
    # . /etc/os-release 会把这些变量加载到当前 Shell 环境，但不会输出。
    OS=$ID
else
    echo "无法检测系统类型"
    exit 1
fi
echo "检测到系统: $OS $VERSION_ID"
# === Rocky Linux 部分 ===
if [ "$OS" = "rocky" ]; then
    echo "检测到 Rocky Linux 系统，正在修改 YUM 源..."
    cd /etc/yum.repos.d
	mkdir /etc/yum.repos.d/bak && mv /etc/yum.repos.d/*.repo bak
    touch  /etc/yum.repos.d/rocky.repo
    A="AppStream"
    B="BaseOS"
    E="epel"
    REPO_FILE="/etc/yum.repos.d/rocky.repo"
    URL_AppStream="https://mirrors.aliyun.com/rockylinux/9/$A/x86_64/os/"
    URL_BESEOS="https://mirrors.aliyun.com/rockylinux/9/$B/x86_64/os/"
    URL_Epel="https://mirrors.aliyun.com/$E/9/Everything/x86_64/"

    if [ ! -f "$REPO_FILE" ]; then
        echo "错误：未找到 $REPO_FILE"
        exit 1
    fi
    
    cat > $REPO_FILE <<EOF
[$B]
name="$NAME"-"$B"
baseurl=$URL_BESEOS
enabled=1
gpgcheck=0

[$A]
name="$NAME"-"$A"
baseurl=$URL_AppStream
enabled=1
gpgcheck=0

[$E]
name="$NAME"-"$E"
baseurl=$URL_Epel
enabled=1
gpgcheck=0
EOF

else    
    dnf clean all 
	dnf makecache
	echo "Rocky Linux 软件源已修改为阿里云镜像。"
fi	
# === ubuntu Linux 部分 ===
if [ "$OS" = "ubuntu" ]; then
	echo "检测到 ubuntu Linux 系统，正在修改 APT 源..."
	ALI="http://mirrors.aliyun.com/ubuntu"
	QingHua="https://mirrors4.tuna.tsinghua.edu.cn/ubuntu/"
	BACKUP="/etc/apt/sources.list.d/ubuntu.sources"
	#在Ubuntu 22.04+默认并不是ubuntu.sources（具体要看系统）。建议加一个检测。
	
    cp "$BACKUP" "$BACKUP"-"$(date +%F)"  
	sed -i  "s@URIs:.*@URIs: $ALI@" "$BACKUP"
	case $VERSION_CODENAME in
		noble|jammy|focal)
		sed -i  "s@$VERSION_CODENAME@jammy@g" "$BACKUP"
		;;
		*)
		echo "***** 未检测到版本代号 *****"
		 ;;
	esac
	echo "ubuntu Linux系统完成更换源任务"
else
    apt update
fi
##############################
echo ">>> 检查并安装常用工具..."
TOOLS=("net-tools" "iputils-ping" "vim" "curl" "wget" "git")

if [ "$PKG_MGR" = "dnf" ]; then
    for t in "${TOOLS[@]}"; do
        if ! rpm -q $t &>/dev/null; then
            echo "安装 $t..."
            dnf install -y $t
        fi
    done
elif [ "$PKG_MGR" = "apt" ]; then
    apt update -y
    for t in "${TOOLS[@]}"; do
        if ! dpkg -s $t &>/dev/null; then
            echo "安装 $t..."
            apt install -y $t
        fi
    done
fi
##############################
read -e -p "请输入静态IP地址 (例如 192.168.1.100): " IPADDR
read -e -p "请输入子网掩码 (默认 24): " NETMASK
NETMASK=${NETMASK:-24}
read -e -p "请输入网关 (例如 192.168.1.1): " GATEWAY
read -e -p "请输入DNS (默认8.8.8.8): " DNS
DNS=${DNS:-8.8.8.8}

# === Rocky Linux 部分 ===
if [ "$OS" = "rocky" ]; then
	nmcli con mod eth0 ipv4.addresses "$IPADDR/$NETMASK"
	nmcli con mod eth0 ipv4.gateway "$GATEWAY"
	nmcli con mod eth0 ipv4.dns "$DNS"
	nmcli con mod eth0 ipv4.method manual
	nmcli con up eth0	
	# 推荐用这个激活网卡，重启 NetworkManager 时可能会掉线
	echo "rocky 静态IP已设置完成。"
	
# === Ubuntu Linux 部分 ===
elif [ "$OS" = "ubuntu" ]; then
    cat > /etc/netplan/50-cloud-init.yaml <<EOF
network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no
      addresses: [$IPADDR/$NETMASK]
      gateway4: $GATEWAY
      nameservers:
        addresses: [$DNS]
EOF
    netplan apply
    echo "Ubuntu 静态IP已设置完成。"
else
	echo "当前操作系统未支持该脚本，请手动配置网络。"
fi

##############################
read -e -p "请输入新的主机名: " NEW_HOSTNAME
if [ -n "$NEW_HOSTNAME" ]; then
    hostnamectl set-hostname "$NEW_HOSTNAME"
    echo "主机名已修改为: $NEW_HOSTNAME"
fi
##############################
```

